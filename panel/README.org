#+STARTUP: showall

* Demo visualization panel

A self-contained demo of the tmon web dashboard (Flask + Chart.js).
Generates a year of synthetic temperature data and serves an
interactive browser UI with current readings and historical charts.

** Quick start

#+begin_example
make demo-server            # generate data + start server
#+end_example

Then open http://localhost:5000 in your browser.

** Running tests

#+begin_example
make check-demo             # run panel pytest suite
#+end_example

** API reference

| Endpoint                                   | Description                                  |
|--------------------------------------------+----------------------------------------------|
| ~GET /~                                    | Dashboard HTML page                          |
| ~GET /api/current~                         | Latest reading per sensor (JSON)             |
| ~GET /api/history?addr=N&hours=H&points=P~ | Historical readings, downsampled to P points |
| ~GET /api/sensors~                         | List of distinct sensor addresses            |
| ~GET /api/export?addr=N&hours=H~           | CSV download for node N, trailing H hours    |
| ~GET /api/range~                           | Min/max timestamps in DB                     |

Time windows are relative to the newest row in the database, so the
mock data always appears current.

*** Examples

#+begin_example
curl http://localhost:5000/api/sensors
# [1, 2, 3]

curl http://localhost:5000/api/current
# [{"addr":1,"ts":"...","temp_0":220,...}, ...]

curl "http://localhost:5000/api/history?addr=1&hours=6&points=100"
# [{"ts":"...","temp_0":215,"temp_1":230,...}, ...]

curl http://localhost:5000/api/range
# {"min":"2024-01-01T00:00:00Z","max":"2024-12-31T23:59:30Z"}
#+end_example

** Static demo

Build a self-contained static version of the dashboard (no Flask
needed to serve it):

#+begin_example
make demo-static              # generate data + build panel/demo/
make demo-static-tar          # package as tmon-demo.tar.gz
make demo-static-clean        # remove panel/demo/ and tarball
#+end_example

The output in ~panel/demo/~ can be served by any HTTP server:

#+begin_example
cd panel/demo && python -m http.server 8000
#+end_example

The tarball wraps everything in a ~tmon-demo/~ top-level directory.
To deploy, extract on the server and point a web server at the
extracted directory.

** How it works

- ~generate_data.py~ creates ~tmon_mock.db~ with the same schema as
  ~server/src/tmon/storage.py~.  3 sensors, 2-4 channels each,
  readings every 30s for 365 days.  Sinusoidal daily/seasonal cycles
  plus Gaussian noise.
- ~app.py~ is a Flask app that reads ~tmon_mock.db~ and serves JSON
  API endpoints plus the dashboard page.
- ~templates/index.html~ uses Chart.js for interactive line charts.
  Dark industrial theme, auto-refresh every 10s.
