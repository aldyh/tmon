[platformio]
default_envs = uart

# Common settings for ESP32-S3
# SLAVE_ADDR defaults to 1; override via environment variable (e.g., SLAVE_ADDR=2 make).
[env_esp32]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
lib_deps = adafruit/Adafruit NeoPixel@^1.12.0

# UART/RS-485 transport (default)
# SLAVE_ADDR can be overridden via environment variable (see slave_addr.py).
[env:uart]
extends = env_esp32
build_src_filter = +<*> -<main_udp.cpp> -<sensors_stub.cpp> -<led_stub.cpp>
extra_scripts = pre:slave_addr.py
build_flags = -DARDUINO_USB_CDC_ON_BOOT=1

# UDP push transport (always-on WiFi, periodic push)
# Credentials and settings loaded from ../master/wifi.toml and
# ../master/config-udp.toml via wifi_config.py.
# SLAVE_ADDR can be overridden via environment variable (see slave_addr.py).
[env:udp]
extends = env_esp32
build_src_filter = +<*> -<main_485.cpp> -<sensors_stub.cpp> -<led_stub.cpp>
extra_scripts = pre:slave_addr.py, pre:wifi_config.py
build_flags = -DARDUINO_USB_CDC_ON_BOOT=1

# Native platform for unit tests
[env:native]
platform = native
test_framework = unity
build_src_filter = +<*> -<main_485.cpp> -<main_udp.cpp> -<sensors.cpp> -<led.cpp>
test_build_src = yes
